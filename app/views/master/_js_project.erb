<script>
  $(document).on('click','#simpanProyek',function(e){
    e.preventDefault();
    var kodeProyek = $('#kode_proyek').val();
    var namaProyek = $('#nama_proyek').val();
    var startDate = $('#start-date').val();
    var endDate = $('#end-date').val();
    var id_proyek = $('#id_proyek').val();
    $('#simpanProyek').text('Loading...');
    if (id_proyek == "") {
      $.ajax({
        url: "/transaksi/projects/create",
        method: 'POST',
        data : {
          authenticity_token: '<%= form_authenticity_token %>',
          kode_proyek:kodeProyek,
          nama_proyek:namaProyek,
          start_date:startDate,
          end_date:endDate
        },
        success: function(data)
        {
          if (data['status'] == 200) {
            window.location = "/master/index?pilihan=Proyek";
          }
        }
      });
    }else{
      $.ajax({
        url: "/transaksi/projects/update",
        method: 'PUT',
        data : {
          authenticity_token: '<%= form_authenticity_token %>',
          kode_proyek:kodeProyek,
          nama_proyek:namaProyek,
          start_date:startDate,
          end_date:endDate,
          id_proyek:id_proyek
        },
        success: function(data)
        {
          if (data['status'] == 200) {
            setInterval(function() {
              window.location = "/master/index?pilihan=Proyek";
            }, 500);
          }
        }
      });
    }
  });

  $(document).on('click', '#ubahProyek', function(e){
    e.preventDefault();
    var id = $(this).data('id');
    $('#id_proyek').empty();
    $('#nama_proyek').empty();
    $('#kode_proyek').empty();
    $('#start-date').empty();
    $('#end-date').empty();
    $('.modal-title').text('Ubah Data');
    $.ajax({
      url: "/transaksi/projects/detail",
      method: 'GET',
      data : {
        id:id
      },
      success: function(data)
      {
        $('#id_proyek').val(id);
        $('#kode_proyek').val(data['data']['kode_proyek']);
        $('#nama_proyek').val(data['data']['nama_proyek']);
        $('#start-date').val(data['data']['start_date']);
        $('#end-date').val(data['data']['end_date']);
      }
    });
  });

  $(document).on('click', '.tambah-proyek', function(){
    var id = 1;
    $('#nama_proyek').val('');
    $('#positions').empty();
    $('#disiplines').empty();
    $('#start-date').empty();
    $('#end-date').empty();
    $('#id_proyek').val('');
    $('.modal-title').text('Tambah Data');
  });

  $(document).on('click','#hapusProyek',function(e){
    e.preventDefault();
    var id = $(this).data('id');
    $.ajax({
      url: "/transaksi/projects/delete",
      method: 'DELETE',
      data : {
        authenticity_token: '<%= form_authenticity_token %>',
        id:id
      },
      success: function(data)
      {
        if (data['status'] == 200) {
          window.location.href = "/master/index?pilihan=Proyek";
        }
      }
    });
  });
</script>